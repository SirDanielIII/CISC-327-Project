{% extends "base.html" %}
{% block title %}Managed Properties{% endblock %}
{% block head %}
    {{ super() }}
    <link rel="stylesheet" href="{{url_for('static', filename='managementAccount.css')}}">
{% endblock %}
{% block properties_classes %}selectedColor{% endblock %}
{% block content %}
    <div class="OutputPlacement">
        <div class="OutputOptionsBar">
            <button class="OptionsButton"
                    onclick="removeSelected()">
                Remove
            </button>
            <button class="OptionsButton"
                    style="margin-right: 1rem;"
                    onclick="location.href='/add_property'">
                Add
            </button>
        </div>
        <div class="PropertyTabs", id="PropertiesContainer">
            {% for property in properties %}
                <div class = "propertyTab" id="{{ property.id }}">
                    <button class="view"
                            onclick="location.href='/property_details/{{ property.id }}'">
                        view
                    </button>
                    <div class="checkButton" onclick="toggleSelect(this)"></div>
                </div>
            {% endfor %}
        </div>
    </div>

    <script>
        function toggleSelect(checkButton) {
            const propertyTab = checkButton.parentElement;
            const selected = propertyTab.classList.toggle('selected');
        }
        function removeSelected() {
            const propertyTabs = document.querySelectorAll('.propertyTab');
            const propertyIds = [];
            propertyTabs.forEach((propertyTab) => {
                if (propertyTab.classList.contains('selected')) {
                    propertyIds.push(propertyTab.id)
                }
            });
            const formData = new FormData();
            formData.append('property_ids', propertyIds.join(','));
            
            fetch('/properties', {
            method: 'POST',
            body: formData
            }).then(response => response.text())
            .then(response => document.querySelector('html').innerHTML = response);
        }
    </script>
{% endblock %}
